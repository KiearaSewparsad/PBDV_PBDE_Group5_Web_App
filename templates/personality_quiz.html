<html>
    <head>
      <meta charset="UTF-8">
      <title>Personality Quiz</title>
      <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    </head>
    <body>
        </br>
        <div class="logo">
            <img src="{{url_for('static', filename='Tutor.jpeg')}}" alt="logo"/>
        </div>
        <br><br>
        <div class="TopNavigation">
            <div class="tabs">
                <a href="{{ url_for('profile') }}" class="active">Profile</a>
                <a href="{{ url_for('quiz') }}">Quiz</a>
                <a href="{{ url_for('sign_out') }}">Logout</a>
            </div>
        </div>
        <div class="sideNavContainer">
            <div class="sideNavTabs">
                <a href="{{ url_for('profile') }}">Dashboard</a>
                <a href="{{ url_for('highPResults') }}">Personality Test Results</a>
                <a href="{{ url_for('highKResults') }}">Knowledge Test Results</a>
                <a href="{{ url_for('studentinfo') }}">Fill in details and document submission</a>
                <a href="{{ url_for('email') }}">Complaints/Queries</a>
                <a href="{{ url_for('notification') }}">Notifications</a>
            </div>
        </div>
        <div class="title">
            <h1>Personality Quiz</h1>
        </div>
        <div class="logo">
            <img src="{{url_for('static', filename='Personality.jpg')}}" alt="Personality">
        </div>
        <br>
        <div class="container">
            <div id="game" class="justify-center flex-column">
                <div id="display">
                    <div class="display-item">
                        <h1 id="progress" class="display-prefix">
                            Question
                        </h1>
                        <div id="progressBar">
                            <div id="progressBarFull"></div>
                        </div>
                    </div>
                    <div class="display-item">
                        <p class="display-prefix">
                            Result
                        </p>
                        <h1 class="display-main-text" id="resultText">
                            0
                        </h1>
                    </div>
                </div>
                <h1 id="question">Do you consider yourself empathetic?</h1>
                <div class="choice-container">
                    <p class="choice-prefix">A</p>
                    <p class="choiceText" data-number="1">Choice 1</p>
                </div>
                <div class="choice-container">
                    <p class="choice-prefix">B</p>
                    <p class="choiceText" data-number="2">Choice 2</p>
                </div>
            </div>
        </div>
        <script>
            const question = document.querySelector('#question');
            const choices = Array.from(document.querySelectorAll('.choiceText'));
            const progress= document.querySelector('#progress');
            const resultText= document.querySelector('#resultText');
            const progressBarFull= document.querySelector('#progressBarFull');
        
            let currentQuestion = {};
            let acceptingAnswers = true;
            let result = 0;
            let questionCounter = 0;
            let availableQuestions = [];
        
            let questions = [
                {
                    question: "Are you empathetic toward others?",
                    choice1: "Yes",
                    choice2: "No",
                    answer: 1,
                },
                {
                    question: "Are you patient?",
                    choice1: "Yes",
                    choice2: "No",
                    answer: 1,
                },
                {
                    question: "Do you consider yourself to be flexible, dynamic and open to changes?",
                    choice1: "Yes",
                    choice2: "No",
                    answer: 1,
                },
                {
                    question: "Are you self-disciplined?",
                    choice1: "Yes",
                    choice2: "No",
                    answer: 1,
                },
                {
                    question: "Do you have good communication skills?",
                    choice1: "Yes",
                    choice2: "No",
                    answer: 1,
                },
                {
                    question: "Do you have a high Emotional IQ?",
                    choice1: "Yes",
                    choice2: "No",
                    answer: 1,
                }
            ];
        
            const POINTS = 1;
            const MAX_Questions = 6;

            startQuiz = () => {
                questionCounter = 0;
                result = 0;
                availableQuestions=[...questions];
                getNewQuestions();
            }
            getNewQuestions = () => {
                if(availableQuestions.length === 0 || questionCounter > MAX_Questions){
                    localStorage.setItem('Recent Result', result)

                    return window.location.assign("{{ url_for('end') }}");
                }
                questionCounter++;
                progress.innerText = `Question ${questionCounter} of ${MAX_Questions}`;
                progressBarFull.style.width = `${(questionCounter/MAX_Questions) * 100}%`;

                const questionIndex = Math.floor(Math.random() * availableQuestions.length);
                currentQuestion = availableQuestions[questionIndex];
                question.innerText = currentQuestion.question;

                choices.forEach(choice => {
                    const number = choice.dataset['number'];
                    choice.innerText = currentQuestion['choice' + number];
                })

                availableQuestions.splice(questionIndex, 1);

                acceptingAnswers = true;
            }

            choices.forEach(choice => {
                choice.addEventListener('click', e => {
                    if(!acceptingAnswers) return 

                    acceptingAnswers = false;
                    const selectedChoice = e.target;
                    const selectedAnswer = selectedChoice.dataset['number'];

                    let classToApply = selectedAnswer  == currentQuestion.answer ? 'correct' : 'incorrect'

                    if (classToApply === 'correct'){
                        incrementResult(POINTS);
                    }

                    selectedChoice.parentElement.classList.add(classToApply);

                    setTimeout(() => {
                        selectedChoice.parentElement.classList.remove(classToApply);
                        getNewQuestions();
                    }, 1000)
                })
            })
            incrementResult = num => {
                result += num;
                resultText.innerText = ((result/MAX_Questions)*100);
            }
            startQuiz()
        </script>
    </body>
</html>